<!DOCTYPE html>
<html>
<head>

	<!-- Recommended meta tags -->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<!-- PyScript CSS -->
	<link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
	<!-- CSS for examples -->
	<link rel="stylesheet" href="./assets/css/examples.css" />
	<!-- This script tag bootstraps PyScript -->
	<script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
	<title>Graph CSV Data</title>
	
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.2.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.2.min.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.2.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/@holoviz/panel@0.13.0/dist/panel.min.js"></script>
    <script type="text/javascript">
      Bokeh.set_log_level("info");
    </script>

    <py-env>
        - numpy
        - pandas
        - panel==0.13.1a2
    </py-env>

	<py-config>
	packages = [
          "panel"
       ]
	</py-config>
	
</head>
	
<body>
  <h1>Upload csv</h1>
          
                <div id="fileinput"></div>
                <div id="upload"></div>
                <div id="table"></div>


	<py-script>
import asyncio
import panel as pn
import pandas as pd
from panel.io.pyodide.ffi import write
import matplotlib.pyplot as plt



async def process_file(event):
    if fileInput.value is not None:
        table.value = pd.read_csv(io.BytesIO(fileInput.value))
	# replace the table display to not None because it has something to display now
        document.getElementById('table').style.display = 'block'

async def main():
	# Input file
	fileInput = pn.widgets.FileInput(accept='.csv')
	uploadButton = pn.widgets.Button(name='Upload', button_type = 'primary')

	table = pn.widgets.Tabulator(pagination='remote', page_size=10)
		
	# Set the table display to None because it has nothing to display
	document.getElementById('table').style.display = 'none'
	
	uploadButton.on_click(process_file)
		
	await write(fileInput, 'fileinput')
	await write(uploadButton, 'upload')
	await write(table, 'table')

main()
		
#plt.close("all")
	</py-script>

</body>
</html>
